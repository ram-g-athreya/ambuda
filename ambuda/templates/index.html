{% extends 'header-main-footer.html' %}
{% import "macros/texts.html" as m %}

{% set mailing_url = 'https://groups.google.com/g/learnsanskrit-announce' %}
{% set code_url = 'https://github.com/ambuda-org/ambuda' %}
{% set contact_url = url_for('about.contact') %}
{% set group = "https://groups.google.com/u/2/g/learnsanskrit-announce" %}
{% set links = [
  ('texts.index', 'Texts'),
  ('dictionaries.index', 'Dictionaries'),
  ('proofing.index', 'Proofing'),
  ('site.support', 'Support'),
  ('about.index', 'About'),
] %}
{% set mobile_only = ["proofing.index", "site.support"] %}
{% block title %}{{ _('Ambuda') }}{% endblock %}

{% set current_locale = session.get('locale', 'en') %}

{% block header %}{% endblock %}


{% block main %}
{# Hero + nav = 100vh #}
<div class="flex flex-col" style="height: 100vh;">
  <div class="bg-brand flex-1 flex flex-col items-center justify-center text-white px-4 pt-12 md:pt-4 pb-6 md:pb-4 relative">
    <nav class="absolute top-0 right-0 p-4 text-sm opacity-80">
      {% if current_user.is_authenticated %}
        {% set name = current_user.username %}
        <a href="{{ url_for('user.summary', username=name) }}" class="hover:underline">{{ name }}</a>
        <span class="opacity-50 mx-1">|</span>
        <a href="{{ url_for('auth.sign_out') }}" class="hover:underline">{{ _('Sign out') }}</a>
      {% else %}
        <a href="{{ url_for('auth.register') }}" class="hover:underline">{{ _('Register') }}</a>
        <span class="opacity-50 mx-1">|</span>
        <a href="{{ url_for('auth.sign_in') }}" class="hover:underline">{{ _('Sign in') }}</a>
      {% endif %}
    </nav>

    <header class="text-center">
      <p class="tracking-widest opacity-70 mb-3">{{ '|| zrIH ||' | hk_to_user_script }}</p>
      <h1 class="text-4xl md:text-7xl font-bold">{{ 'ambudaH' | hk_to_user_script }}</h1>
      <p class="mt-8 text-xl opacity-60 tracking-wide">{{ 'nAma saMskRtagranthAlayaH'|hk_to_user_script }}</p>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-10 w-56 md:w-auto">
      <a href="#library"
         class="px-6 py-2.5 border border-sky-500 bg-sky-500 text-white font-semibold rounded hover:bg-transparent transition text-sm text-center">
        {{ _('Explore the library') }}
      </a>
      <a href="{{ url_for('site.support') }}"
         class="px-6 py-2.5 border border-white/40 text-white font-semibold rounded hover:bg-white/10 transition text-sm text-center">
        {{ _('Help us grow') }}
      </a>
    </div>

    <div class="absolute bottom-8 left-0 right-0 flex flex-col md:flex-row gap-3 md:gap-6 items-center justify-center text-sm opacity-70">
      <label class="flex items-center gap-2">
        <span class="opacity-60">{{ _('Language:') }}</span>
        <select
          class="bg-white/10 border border-white/20 text-white rounded px-3 py-1.5 cursor-pointer"
          onchange="if(this.value) window.location.href=this.value"
        >
          {% for L in ambuda_locales %}
          <option value="{{ url_for('site.set_language', slug=L.slug) }}"
            class="text-black bg-white"
            {{ 'selected' if L.code == current_locale }}>{{ L.text }}</option>
          {% endfor %}
        </select>
      </label>

      <label class="flex items-center gap-2">
        <span class="opacity-60">{{ _('Script:') }}</span>
        <select id="index-script-select"
          class="bg-white/10 border border-white/20 text-white rounded px-3 py-1.5 cursor-pointer"
          onchange="if(this.value) fetch('/script/' + this.value).finally(() => location.reload())"
        >
          {% include 'include/script-options-vidyut.html' %}
        </select>
      </label>
    </div>
  </div>

  {# Navigation bar #}
  <nav class="bg-white border-t border-slate-200 shrink-0">
    <div class="flex items-center justify-center flex-wrap gap-x-8 gap-y-1 px-4 py-3 text-sm font-medium text-slate-700">
      <a href="{{ url_for('texts.index') }}" class="hover:text-sky-700 transition">{{ _('Texts') }}</a>
      <a href="{{ url_for('dictionaries.index') }}" class="hover:text-sky-700 transition">{{ _('Dictionaries') }}</a>
      <a href="{{ url_for('proofing.index') }}" class="hover:text-sky-700 transition">{{ _('Proofing') }}</a>
      <a href="{{ url_for('site.donate') }}" class="hover:text-sky-700 transition" target="_blank">{{ _('Donate') }}</a>
      <a href="{{ url_for('about.index') }}" class="hover:text-sky-700 transition">{{ _('About') }}</a>
    </div>
  </nav>

</div>

{# Text listing #}
<article id="library" class="px-6 md:px-8 mx-auto max-w-5xl pb-16 md:pb-24">
  {{ m.grouped_texts(grouped_entries) }}
</article>

{# Sync session script value to localStorage for reader.js compat #}
<script>
(function() {
  var sel = document.getElementById('index-script-select');
  if (!sel) return;
  try {
    var stored = JSON.parse(localStorage.getItem('reader') || '{}');
    stored.script = sel.value;
    localStorage.setItem('reader', JSON.stringify(stored));
  } catch(e) {}
})();
</script>
{% endblock %}
