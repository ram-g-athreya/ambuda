{% extends 'proofing/base.html' %}
{% import "macros/components.html" as mc %}
{% import "macros/proofing.html" as m %}


{% macro _badge(bg) %}
<span class="inline-block rounded-full border w-4 h-4 mr-1 {{ bg }}"></span>
{% endmacro %}


{% macro status_legend() %}
<ul class="text-xs bg-slate-100 my-4 grid grid-cols-2 md:flex">
  <li class="p-2 flex items-center">{{ _badge("bg-red-200 border-red-400") }} {{ _('Needs more work') }}</li>
  <li class="p-2 flex items-center">{{ _badge("bg-yellow-200 border-yellow-400") }} {{ _('Proofed once') }}</li>
  <li class="p-2 flex items-center">{{ _badge("bg-green-200 border-green-400") }} {{ _('Proofed twice') }}</li>
  <li class="p-2 flex items-center">{{ _badge("bg-gray-200 border-gray-400") }} {{ _('Not relevant') }}</li>
</ul>
{% endmacro %}


{% block title %}{{ mc.title(_('Projects')) }}{% endblock %}


{% block content %}
{{ m.header(_('Projects')) }}
{{ m.proofing_tabs('projects', current_user) }}

{% if projects %}
{{ status_legend() }}

<div x-data="sortableList('title')">

{{ m.list_toolbar(_('Search for a project title'), [('title', _('Title')), ('created', _('Creation date')), ('progress', _('Progress'))]) }}

<ul x-ref="list">
  {% for p in projects %}
  <li data-key="{{ p.id }}"
      data-title="{{ p.display_title }}"
      data-created="{{ p.created_at }}"
      data-progress="{{ progress_per_project[p.id] }}"
      x-show="displayed.has('{{ p.id }}')">
    <div class="mt-4 a-hover-underline flex justify-between items-baseline">
      <a href="{{ url_for("proofing.project.summary", slug=p.slug) }}">{{ p.display_title }}</a>
      {% set count = pages_per_project[p.id] %}
      <span class="text-xs">
        {{ ngettext('%(num)d page', '%(num)d pages', count) }}
      </span>
    </div>

    <div class="flex">
    {% for cls, fraction in statuses_per_project[p.id].items() %}
      <div class="h-1 {{ cls }}" style="width: {{ fraction * 100 }}%"></div>
    {% endfor %}
    </div>

    {% if p.description %}
    <section class="mt-2 text-slate-600 text-sm">
      {{ p.description|markdown|safe }}
    </section>
    {% endif %}
  </li>
  {% endfor %}
</ul>
</div>
{% else %}
<div class="prose">
<p>{% trans create_url=url_for('proofing.create_project') %}There aren't any ongoing projects. <a href="{{ create_url }}">Create a new project to get started</a>.{% endtrans %}</p>
</div>
{% endif %}

{% if pending_projects %}
<h2 class="font-bold text-xl mt-10 mb-2">{{ _('Pending') }}</h2>

<div x-data="sortableList('title')">

{{ m.list_toolbar(_('Search for a pending project'), [('title', _('Title')), ('created', _('Creation date'))]) }}

<ul x-ref="list">
  {% for p in pending_projects %}
  <li data-key="{{ p.id }}"
      data-title="{{ p.display_title }}"
      data-created="{{ p.created_at }}"
      x-show="displayed.has('{{ p.id }}')"
      class="py-3 border-b border-gray-200">
    <div class="flex justify-between items-center">
      <a href="{{ url_for("proofing.project.summary", slug=p.slug) }}" class="text-sky-900 hover:underline font-medium">
        {{ p.display_title }}
      </a>
      <span class="text-xs px-2 py-1 rounded bg-yellow-100 text-yellow-800">
        {{ _('Pending') }}
      </span>
    </div>
  </li>
  {% endfor %}
</ul>
</div>
{% endif %}

{% endblock %}
